<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>SynchroTime: SynchroTime - CLI- and GUI-client for adjust the exact time and calibrating the RTC DS3231 module</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="icon.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">SynchroTime
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">SynchroTime - CLI- and GUI-client for adjust the exact time and calibrating the <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> DS3231 module </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a href="https://sergejbre.github.io/SynchroTime/doc/html/index.html">html ./images/doxygen_badge.svg "Documentation"</a><a href="https://github.com/SergejBre/SynchroTime/releases">html ./images/release_badge.svg "releases page"</a></p>
<div class="image">
<img src="guiApp_About.png" alt="guiApp_About.png"/>
<div class="caption">
PROJECT_IMAGE</div></div>
 <h2>Motivation</h2>
<p>The real-time clock module on the <a href="https://create.arduino.cc/projecthub/MisterBotBreak/how-to-use-a-real-time-clock-module-ds3231-bc90fe">DS3231</a> chip has proven itself well in work with microcontrollers Arduino, Raspberry Pi, etc. According to the declared specification, it is an extremely accurate <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> with a guaranteed accuracy ±2 ppm (from 0°C to +40°C), which translates into an error of just 1 minute over the course of a year under the worst case scenario. But a large number of modules on the market do not meet the accuracy declared by the manufacturer, which is undoubtedly upsetting. Nevertheless, the manufacturer has provided for the possibility of correcting the drift of the clock time, which is associated with the aging of the oscillator crystal in the range from -12.8 to +12.7 ppm. This correction value can be written to one of the registers on the DS3231 (See part <b>Discussion</b> for exact ppm values). In addition, the manufacturer has provided a the energy-independent flash memory AT24C256 in the module, into which calibration parameters and correction factors can be placed. The tool below can automatically calibrate the DS3231 module.</p>
<h2>About the app</h2>
<ul>
<li>CLI and GUI applications are used for fine adjust and calibrating the DS3231 <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> module.</li>
<li>The application allows you to:<ul>
<li>Synchronize the time of the <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> DS3231 with your computer time;</li>
<li>Correct the time drift of the DS3231-RTC clock. The algorithm performs correction in the range from -12.8 to +12.7 ppm;</li>
<li>The application allows you to evaluate the accuracy and reliability of the <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> oscillator for a particular sample, as well as the chances of successful correction in case of significant time drift;</li>
<li>Automatically save parameters and calibration data to the energy-independent flash memory of the type AT24C256. In case there is a power failure to the module.</li>
</ul>
</li>
<li>Developed in pure Qt, no third party libraries.</li>
<li>Cross-platform application implementation (Linux and Windows).</li>
<li>The client communicates with the Arduino server via the serial interface (UART). The application allows you to easily select a serial port for communication with the server and save the port number in the program settings.</li>
<li>Command Help <code>$ ./synchroTime -h</code></li>
</ul>
<div class="image">
<img src="consoleApp_About.png" alt="consoleApp_About.png"/>
<div class="caption">
synchroTime -h</div></div>
 <h2>Using the CLI app</h2>
<ol type="1">
<li>First, you need to load a sketch into Arduino from the <a href="arduino/synchro_RTC.ino">arduino/synchro_RTC.ino</a> project directory and connect the <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> DS3231 module according to the circuit shown in the specification. Connect your Arduino to your computer via a free USB port. If there is a necessary driver in the system, a new virtual serial port will appear in the system (under Linux it will be <code>/dev/ttyUSBx</code>, under Windows - <code>COMx</code>). To find the name of this port, call the application with the <code>-d (--discovery)</code> switch: <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./synchroTime -d</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Serial Port : ttyUSB1</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Description : USB2.0-Serial</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Manufacturer: 1a86</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Vendor ID   : 1a86</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Product ID  : 7523</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;System Locat: /dev/ttyUSB1</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;Busy        : No</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;Serial Port : ttyUSB0</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;Description : USB2.0-Serial</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;Manufacturer: 1a86</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Vendor ID   : 1a86</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;Product ID  : 7523</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;System Locat: /dev/ttyUSB0</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;Busy        : No</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;A total of 2 serial ports were found.</div></div><!-- fragment --> And under the Windows OS <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;C:\\SynchroTime\\build&gt;synchroTime -d</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Serial Port : COM5</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Description : USB-SERIAL CH340</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Manufacturer: wch.cn</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Vendor ID   : 1a86</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Product ID  : 7523</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;System Locat: \\\.\\COM5</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;Busy        : No</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;Serial Port : COM3</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;Description : Agere Systems HDA Modem</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;Manufacturer: Agere</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;Vendor ID   : 11c1</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;Product ID  : 1040</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;System Locat: \\\.\\COM3</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;Busy        : No</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;A total of 2 serial ports were found.</div></div><!-- fragment --></li>
<li>To select a virtual Serial Port, enter its system name after the command <code>-p \&lt;portName\&gt;</code>. The app will automatically create a configuration file, and the next call will contact the selected port. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./synchroTime -p ttyUSB0</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Added new serial interface ttyUSB0. </div></div><!-- fragment --> And under the Windows OS <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;C:\\SynchroTime\\build&gt;synchroTime -p COM5</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;Added new serial interface COM5.</div></div><!-- fragment --></li>
<li>Use the <code>-i (--information)</code> command to get the current information from the DS3231 module. If everything is connected correctly, then you will get the current time of both clocks, the difference between the clocks in milliseconds (with an accuracy of ±2 ms), the value written in the offset register and the calculated time drift value in ppm. If the offset register and time drift are zero, then the DS3231 has not yet been calibrated (see step 5.) <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./synchroTime -i</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;DS3231 clock time  1598896552596 ms: 31.08.2020 19:55:52.596</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;System local time  1598896589772 ms: 31.08.2020 19:56:29.772</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Difference between -37176 ms</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Offset reg. in ppm 0 ppm</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Time drift in ppm  -8.78162 ppm</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;last adjust of time    1594663200000 ms: 13.07.2020 20:00:00.000 </div></div><!-- fragment --></li>
<li>To set the exact time, use the <code>-a (--adjust)</code> command. The module clock will be synchronized with the computer time with an accuracy of ±1 ms. After updating the time, the date of the time setting will be recorded in the module's memory, which will allow later to determine the exact drift of the clock time. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./synchroTime -a</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;System local time  Mo. 31 Aug. 2020 20:02:52.000</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Request for adjustment completed successfully. </div></div><!-- fragment --></li>
<li>To calibrate the clock of the DS3231 module, enter the <code>-c (--calibration)</code> command. For the successful execution of this procedure, the module must be activated (see point 4.) and it is necessary that enough time has passed so that the calculated value of the clock drift is well distinguishable from the rounding error (ca 55 hours or 2.3 days, see part <b>Discussion</b>). The algorithm of the program will calculate the amount of drift of the clock time and the correction factor, which will be written into the offset register. The clock time will also be updated. If the calibration is successful, the current time, drift and correction factor will be displayed, as in the screenshot. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./synchroTime -c</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;System local time  Mo. 31 Aug. 2020 20:04:14.000</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Offset last value  0</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Time drift in ppm  -2.11938 ppm</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;Offset new value   -21</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Request for calibration completed successfully. </div></div><!-- fragment --></li>
<li>To reset the offset register to its default value and clear the module's memory of calibration data, enter the <code>-r (--reset)</code> command. The default value will be written to the register, and memory cells will be overwritten with bytes with <code>0xFF</code>. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./synchroTime -r</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Request for reset completed successfully. </div></div><!-- fragment --></li>
<li>Use the <code>-s (--setreg)</code> command to add a new value (e.g. <code>-12.8</code>) to the offset register of the DS3231. The new value will be added arithmetically to the old register value. The result will be limited to the values 12.7 and -12.8. <b>Warning: it makes sense to do this operation only in case of resetting all calibration data (see step 6)</b>. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ./synchroTime -s -12.8</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;Request for SetRegister completed successfully. </div></div><!-- fragment --></li>
</ol>
<h2>Using the GUI app</h2>
<p>All functionality is similar to the CLI application (see figure below). As an extra, there is the option of selecting the numerous serial port settings and three features: <b>Status Control</b>, <b>Access Rate</b> and <b>Correction Factor</b>. The <b>Correction Factor</b> is described in detail in the <b>Discussion</b> part. <b>Status Control</b> is an additional functionality to monitor the connection with a device with a <b>Request Rate</b> (from 500 to 10000 ms). The <b>Access Rate</b> feature allows you to display the approximate delay in the exchange of information with the device on the monitor. For the exchange rate of 115200 baud and the exchange of one pair of bytes with the Device, the delay usually should not exceed 3-4ms (depends mainly on the driver used and the HW UART device). Both features can be deactivated.</p>
<div class="image">
<img src="guiApp_About2.png" alt="guiApp_About2.png"/>
<div class="caption">
PROJECT_IMAGE2</div></div>
 <div class="image">
<img src="serial_port_settings.png" alt="serial_port_settings.png"/>
<div class="caption">
SERIAL_PORT_SETTINGS</div></div>
 <h2>Specification</h2>
<ul>
<li>The application allows you to adjust the time with an accuracy of ±1 ms (under Linux OS).</li>
<li>The application allows you to control the time difference between the DS3231 module and the computer with an accuracy of ±2 ms (under Linux OS).</li>
<li>The application allows you to calibrate the module clock within the range from -12.8 to +12.7 ppm.</li>
<li>Calibration by Offset Register is stable over the operating temperature range from 0°C to +40°C (see part <b>Discussion</b>).</li>
<li>The application communicates with the Arduino server through any virtual serial interface (UART). The Baud Rate is assumed unchanged and equals 115200 bps.</li>
<li>The Arduino is in turn connected to the Precision <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> DS3231 module via the I²C-interface: A4 (SDA), A5 (SCL) pins (SDA - data line and SCL - clock line).</li>
<li>The interrupt on the port D2 (or D3) serves to count milliseconds by the internal Arduino counter millis.</li>
<li>The suggested connection to the DS3231 module is according to the Circuit below. <div class="image">
<img src="Steckplatine_DS3231.png" alt="Steckplatine_DS3231.png"/>
<div class="caption">
CIRCUIT</div></div>
 <h2>Description of the request protocol</h2>
</li>
</ul>
<p>The computer is a client. The client is always the first to send a request. Upon receipt of each request, the microprocessor must send back the appropriate response.</p>
<p>Each request is as follows: <code>&lt;@ req&gt; &lt;local time&gt; or &lt;value&gt; [CRC]</code>, where:</p><ul>
<li><code>@</code> - mandatory start byte, sign for the beginning of the transfer (always equal to <code>0x40</code>, 1 byte),</li>
<li><code>req</code> - request from the set <code>{a, c, i, r, s, t}</code> (size 1 byte),</li>
<li><code>local time</code> - local computer time only for requests <code>a, c, i</code> (size 6 bytes),</li>
<li><code>value</code> - new value for the offset register only for request <code>s</code> (size 4 bytes),</li>
<li><code>CRC</code> - checksum (size 1 byte). The checksum is calculated as the sum of all bytes, starting from the first byte of the request command and ending with the last byte of data,</li>
<li><code>a</code> - time adjustment request,</li>
<li><code>c</code> - calibrating request,</li>
<li><code>i</code> - information request,</li>
<li><code>s</code> - set offset register request,</li>
<li><code>r</code> - reset request,</li>
<li><code>t</code> - status request.</li>
</ul>
<h3>Protocol table</h3>
<table class="doxtable">
<tr>
<th>Request Name </th><th>Head </th><th>Request Data </th><th>Size b</th><th>Expected response on request  </th></tr>
<tr>
<td>Time adjustment </td><td><code>@a</code> </td><td><code>&lt;local time&gt; [CRC]</code></td><td>2+6+1 </td><td><code>&lt;successful/failed&gt;</code> </td></tr>
<tr>
<td>Calibrating </td><td><code>@c</code> </td><td><code>&lt;local time&gt; [CRC]</code></td><td>2+6+1 </td><td><code>&lt;old Val&gt; &lt;drift&gt; &lt;new Val&gt; &lt;succ/fail&gt;</code> </td></tr>
<tr>
<td>Information </td><td><code>@i</code> </td><td><code>&lt;local time&gt; [CRC]</code></td><td>2+6+1 </td><td><code>&lt;<a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> time&gt; &lt;Val&gt; &lt;drift&gt; &lt;Last Set time&gt;</code> </td></tr>
<tr>
<td>Set offset Register </td><td><code>@s</code> </td><td><code>&lt;value&gt; [CRC]</code> </td><td>2+4+1 </td><td><code>&lt;successful/failed&gt;</code> </td></tr>
<tr>
<td>Reset </td><td><code>@r</code> </td><td><code>[CRC]</code> </td><td>2+1 </td><td><code>&lt;successful/failed&gt;</code> </td></tr>
<tr>
<td>Status </td><td><code>@t</code> </td><td><code>[CRC]</code> </td><td>2+1 </td><td><code>&lt;successful/failed&gt;</code> </td></tr>
</table>
<h2>System Requirements</h2>
<ul>
<li>For correct work your system time required to be synchronized with Network Time Protocol (NTP). Only in this case the program will work according to the declared specifications. Under Linux, the ntp service is installed by the following command <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ sudo apt-get install ntp </div></div><!-- fragment --></li>
<li>Check the correct operation of the service ntp by running the command <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160; $ ntpq -p</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;     remote           refid      st t when poll reach   delay   offset  jitter</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;==============================================================================</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;+gromit.nocabal. 131.188.3.222    2 u   64   64  377   27.218   -3.906   5.643</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;*www.kashra.com  .DCFa.           1 u    3   64  377   42.583   -5.584   4.940</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;+ext01.epiontis. 130.149.17.8     2 u    2   64  177   18.668   -7.450   5.801</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;+ntp1.hetzner.de 124.216.164.14   2 u   11   64  377   25.011   -5.987   6.489</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;+chilipepper.can 134.71.66.21     2 u   74   64  376   26.689   -5.881   4.974 </div></div><!-- fragment --></li>
<li>The columns <b>delay</b>, <b>offset</b> and <b>jitter</b> show some timing values which are derived from the query results. In some versions of ntpq the last column is labeled <b>disp</b> (for dispersion) instead of <b>jitter</b>. All values are in in milliseconds (ms).<ul>
<li>The <b>delay</b> value is derived from the roundtrip time of the queries.</li>
<li>The <b>offset</b> value shows the difference between the reference time and the system clock.</li>
<li>The <b>jitter</b> value indicates the magnitude of jitter between several time queries.</li>
</ul>
</li>
<li>Look for a table entry <code>*</code>: table values offset and jitter, they should be as minimal as possible <code>max|offset ± jitter| &lt;= 10ms</code>. If this is not the case, adjust the configuration file <code>/etc/ntp.conf</code> in which you enter the local time servers.</li>
<li>The OS Windows has its own specifics. Windows <code>W32tm</code> Time Service synchronizes time once a week, which is not enough for fine tuning and calibration. The optimal solution for OS Windows would be to install a new NTP time synchronization system service to replace the default W32Time service. As an example, you can use one of the advanced projects: <a href="https://www.meinbergglobal.com/english/sw/ntp.htm">NTP for Windows</a>.</li>
</ul>
<h2>Installing the CLI and GUI apps</h2>
<ul>
<li>According to the working platform, download the appropriate archive with the app from <a href="https://github.com/SergejBre/SynchroTime/releases">html ./images/release_badge.svg "releases page"</a>.</li>
<li>Unpack it to your home directory with write access, as the application retains its settings. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ tar -xvf SynchroTime_x64_linux_v1.1.0-beta.tar.xz</div></div><!-- fragment --></li>
<li>Run the application according to the instructions in the section <b>Using the CLI or GUI app</b>. <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ cd SynchroTime</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;SynchroTime$ ./synchroTime -h</div></div><!-- fragment --></li>
</ul>
<h2>Discussion</h2>
<p>DS3231 is an extremely accurate <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> with a guaranteed accuracy of 2 ppm (from 0°C to +40°C), which translates into an error of just 60 seconds over the course of a year under the worst case scenario.</p>
<p>While by default DS3231 is already very accurate, we can push its accuracy even higher by adjusting its aging offset register (8bit). This adjustment works by adding or subtracting the corresponding capacitance to or from the oscillator capacitor array. The adjustable range is represented as 2’s complement (-128 to 127) and each LSB change corresponds to ca 0.1 ppm of change in frequency (which translates into roughly between 0.002 to 0.003 Hz). So the overall adjustment range can be achieved programmatically is ca ±13 ppm.</p>
<p>In its default configuration, the TCXO frequency is adjusted every 64 seconds depending on the environmental temperature by switching in or switching out capacitance via an internal look-up table. By utilizing the aging register, we can further null out any remaining offset. The aging offset adjustment is independent of the automatic adjustment via temperature compensation.</p>
<p>The aging offset register is at address 0x10 and the valid values for the input parameter offset ranges from -128 to 127. By default, the offset value is 0.</p>
<p>Manipulation with the Aging Register within LBS values ​​affects the thermal stabilization of the oscillator. This is reflected in the graph from the DS3231 <a href="https://datasheets.maximintegrated.com/en/ds/DS3231.pdf">datasheet</a> below. According to the curves of the dependences of Frequency Deviation on Temperature and LBS Values, it is seen that there is a stability interval where frequency deviation remains quite stable. This range is between 0°C and +40°C. And according to the <a href="https://datasheets.maximintegrated.com/en/ds/DS3231.pdf">datasheet</a>, at room temperature +25°C for each LSB change Aging Register corresponds approximately 0.1ppm Frequency Deviation (i.e. 1 ≈ 0.1ppm). We use this data in our further calculations.</p>
<blockquote class="doxtable">
<p>⚠️ <b>Please note that this will limit the operating temperature range!</b> </p>
</blockquote>
<div class="image">
<img src="frequency_deviation.png" alt="frequency_deviation.png"/>
<div class="caption">
Frequency deviation</div></div>
<p> Having a graph of the dependence of the Oscillator Frequency Deviation on the Aging Register Values, the user can independently enter the correction factor k into the calculation. By choosing this factor in an appropriate way, you can get a better approximation for calculating the new value of the Aging register <code>v</code> from the frequency deviation <code>Δf</code>, i.e. </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;v(Δf) = k * Δf,</div></div><!-- fragment --><p> which will be displayed in the parameter list under the name: <code>Corrected value***</code>. The last value can be entered into the Aging register manually, via Request: <code>Set Register &lt;v&gt;</code>.</p>
<p>A graph showing the approximate dependence of the Frequency Deviation on the Aging Register Values ​​is presented below:</p>
<div class="image">
<img src="linear_approximation.png" alt="linear_approximation.png"/>
<div class="caption">
Linear approximation</div></div>
 <h2>Documentation</h2>
<p>For the detailed API documentation, see <a href="https://sergejbre.github.io/SynchroTime/doc/html/index.html">link</a>. Documentation is produced by doxygen.</p>
<h2>Dependencies</h2>
<table class="doxtable">
<tr>
<th>Name </th><th>Version </th><th>Comment  </th></tr>
<tr>
<td>Qt lib 32bit </td><td>&gt;= 5.5.1 </td><td>Didn't test with older versions, but it may work </td></tr>
<tr>
<td>Qt lib 64bit </td><td>&gt;= 5.6 </td><td>Didn't test with older versions, but it may work </td></tr>
<tr>
<td>C++ compiler </td><td>supporting C++11 (i.e. gcc 4.6+) </td><td></td></tr>
<tr>
<td>Arduino IDE </td><td>&gt;= 1.8.13 </td><td>!Replace compilation flags from -Os to -O2 </td></tr>
<tr>
<td><a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> library </td><td>&gt;= 1.12.5 </td><td>Adafruit <a class="el" href="classRTC.html" title="The RTC class. ">RTC</a> library for Arduino <a href="https://github.com/adafruit/RTClib">RTClib</a> </td></tr>
</table>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;$ ldd synchroTime</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;   libQt5SerialPort.so.5 =&gt; ./lib/libQt5SerialPort.so.5</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;   libQt5Core.so.5 =&gt; ./lib/libQt5Core.so.5</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;   ...</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;   libicui18n.so.54 =&gt; ./lib/libicui18n.so.54</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;   libicuuc.so.54 =&gt; ./lib/libicuuc.so.54</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;   libicudata.so.54 =&gt; ./lib/libicudata.so.54</div></div><!-- fragment --><h2>Compilation on Linux</h2>
<ul>
<li><code>sudo apt-get install build-essential qt5-default qt5-qmake gdb git</code></li>
<li><code>git clone <a href="https://github.com/SergejBre/SynchroTime.git">https://github.com/SergejBre/SynchroTime.git</a></code></li>
<li><code>cd ./SynchroTime</code></li>
<li><code>QT_SELECT=5 qmake SynchroTime.pro</code></li>
<li><code>make &amp;&amp; make clean</code></li>
</ul>
<h2>License</h2>
<p>SynchroTime is licensed under [</p><div class="image">
<img src="license_badge.svg" alt="license_badge.svg"/>
<div class="caption">
MIT</div></div>
<p>](LICENSE) </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Mon Apr 12 2021 14:05:25 for SynchroTime by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
